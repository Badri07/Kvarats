<div class="scheduler-container">
  <!-- Header -->
  <div class="bg-white shadow-sm border-b px-6 py-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <!-- Previous Day Button -->
        <button
          (click)="goToPreviousDay()"
          class="p-2 hover:bg-white hover:shadow-sm rounded-md transition-all duration-200"
        >
          <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>

        <!-- Compact Date Picker -->
        <input
          type="date"
          id="date-picker"
          class="px-4 py-2 bg-white rounded-md shadow-sm border"
          [value]="selectedDate | date : 'yyyy-MM-dd'"
          (change)="onDateChange($event)"
        />

        <!-- Next Day Button -->
        <button
          (click)="goToNextDay()"
          class="p-2 hover:bg-white hover:shadow-sm rounded-md transition-all duration-200"
        >
          <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </button>
      </div>

      <div class="flex justify-end items-center space-x-2">
  <!-- Filter Icon -->
  <button class="flex items-center space-x-2 px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-all duration-200">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"></polygon>
        </svg>
        <span class="text-sm font-medium">Filter</span>
      </button>

  <!-- Add Event Button -->
  <button
    class="px-4 py-2 text-white font-medium rounded-md transition-colors duration-200 hover:opacity-90"
    style="background-color: #FFA157"
    (click)="onAddEventClick()"
  >
    + Add Event
  </button>
</div>

        
    </div>
  </div>

  <!-- Loading State -->


  <!-- Scheduler Grid -->
  <div
 
    class="scheduler-grid bg-white flex overflow-x-auto relative"
  >
    <!-- Time Column -->
    <div class="w-24 flex-shrink-0 sticky left-0 z-10 bg-white">
      <!-- Time Header (same height as user headers) -->
      <div
        class="h-[144px] bg-gray-50 border-r border-b border-gray-200 flex items-center justify-center font-semibold text-sm text-gray-700"
      >
        Time
      </div>

      <!-- Time Slots -->
      <div
        *ngFor="let timeSlot of timeSlots"
        class="h-12 flex items-center justify-center text-sm text-gray-600 border-r border-b border-gray-100 bg-gray-50"
      >
        {{ timeSlot.displayTime }}
      </div>
    </div>

    <!-- Scrollable Grid Section -->
    <div class="min-w-[800px]">
      <!-- Therapist Header Row -->
      <div
        class="grid border-b border-gray-200 bg-gray-50"
        [style.grid-template-columns]="'repeat(' + users.length + ', 200px)'"
      >
        <div
          *ngFor="let user of users; let i = index"
          class="p-4 text-center border-r border-gray-200 last:border-r-0 h-[144px]"
        >
          <div class="flex flex-col items-center space-y-2">
            <!-- User Avatar -->
            <div class="relative">
              <div class="user-avatar bg-[#f97316] text-white relative">
                {{ getUserInitials(user.name) }}
                <div
                  class="status-dot absolute bottom-0 right-0 rounded-full w-3 h-3 border border-white"
                  [ngClass]="getStatusColor(user.status)"
                ></div>
              </div>
            </div>

            <!-- User Info -->
            <div>
              <div class="font-semibold text-sm text-gray-900">
                {{ user.name }}
              </div>
              <div class="text-xs text-gray-500">{{ user.role }}</div>
              <div
                *ngIf="user.availableFrom && user.availableTo"
                class="text-xs text-gray-400 mt-1"
              >
                {{ user.availableFrom }} - {{ user.availableTo }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Time Slot Rows -->
      <div class="relative">
        <!-- Current Time Line -->
<div
  *ngIf="isCurrentTimeVisible()"
  class="current-time-line absolute w-100% left-0 right-0 z-20 pointer-events-none"
  [style.top.px]="currentTimePosition"
>
  <div class="flex items-center">
    <!-- Time column part -->
    <div class="w-24 flex-shrink-0 flex items-center justify-center">
      <div class="current-time-label bg-amber-500 text-white text-xs px-2 py-1 rounded-md shadow-md">
        {{ getCurrentTimeString() }}
      </div>
    </div>
    <!-- Line across user columns -->
    <div class="current-time-line-bar flex-1 h-px bg-amber-500"></div>
  </div>
</div>
        

        <div
          *ngFor="let timeSlot of timeSlots"
          class="grid h-12 border-b border-gray-100"
          [style.grid-template-columns]="'repeat(' + users.length + ', 200px)'"
        >
          <div
            *ngFor="let user of users"
            class="scheduler-time-slot relative h-12 group border-r last:border-r-0"
          >
            <ng-container
              *ngIf="
                getAppointmentForSlot(user, timeSlot.id) as appointment;
                else availableSlot
              "
            >
              <div
                class="appointment-block w-full h-full flex items-center px-2"
                [ngStyle]="getAppointmentStyle(appointment)"
              >
                <div class="truncate">
                  <div class="font-medium text-xs">{{ appointment.title }}</div>
                  <div class="text-xs opacity-90">{{ appointment.type }}</div>
                </div>
              </div>
            </ng-container>

           <div class="group relative w-full h-full">
  <ng-template #availableSlot>
    <ng-container
      *ngIf="
        isSlotWithinAvailability(user, timeSlot.time) &&
          !isPastTimeSlot(timeSlot.time);
        else unavailableSlot
      "
    >
      <div class="slot-button" (click)="onSlotClick(user, timeSlot)">
        <i class="fas fa-plus"></i>
      </div>
    </ng-container>
  </ng-template>
  
  <ng-template #unavailableSlot>
  <div class="unavailable-overlay"></div>
</ng-template>
</div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Legend -->
  <div
    class="fixed bottom-4 right-4 bg-white rounded-lg shadow-md border p-3 z-50 w-32"
  >
    <h4 class="text-xs font-semibold text-gray-800 mb-2">Status Legend</h4>
    <div class="space-y-2">
      <div class="flex items-center space-x-2">
        <div class="w-3 h-3 rounded-full bg-status-available"></div>
        <span class="text-xs text-gray-600">Available</span>
      </div>
      <div class="flex items-center space-x-2">
        <div class="w-3 h-3 rounded-full bg-status-busy"></div>
        <span class="text-xs text-gray-600">Busy</span>
      </div>
      <div class="flex items-center space-x-2">
        <div class="w-3 h-3 rounded-full bg-status-away"></div>
        <span class="text-xs text-gray-600">Away</span>
      </div>
      <div class="flex items-center space-x-2">
        <div class="w-3 h-3 rounded-full bg-gray-400"></div>
        <span class="text-xs text-gray-600">Offline</span>
      </div>
    </div>
  </div>
</div>

<div class="dashboard-container container">
<div class="animated-tabs">
  <div class="slider"></div>
  <div class="tab" [class.active]="selectedTab === 'existing-availability'" (click)="setTab('existing-availability')">
      <i class="fas fa-calendar-days"></i>
      <span>Availability List</span>
    </div>

  <div class="tab" [class.active]="selectedTab === 'availability'" (click)="setTab('availability')">
      <i class="fas fa-plus-circle"></i>
      <span>Add Availability</span>
    </div>

   <div class="tab" [class.active]="selectedTab === 'list-leave'" (click)="setTab('list-leave')">
      <i class="fas fa-calendar-check"></i>
      <span>Leave List</span>
    </div>

 <div class="tab" [class.active]="selectedTab === 'leave'" (click)="setTab('leave')">
      <i class="fas fa-plus-circle"></i>
      <span>Add Leave</span>
    </div>
</div>


<div *ngIf="selectedTab === 'availability'" class="card-wrapper mb-4">
    <div class="card-body mt-4">
      <h3 class="card-title">{{ isEditMode ? 'Update Doctor Availability' : 'Set Doctor Availability' }}</h3>
      <form [formGroup]="availabilityform" (ngSubmit)="onSubmit()">
        <div class="row mt-4">
          <div class="col-md-4 col-12">
            <label for="therapist" class="form-label">Therapist</label>
           <select [ngClass]="{
      'is-invalid': availabilitySubmitted && availabilityUser['userId'].invalid,
      'is-valid': availabilitySubmitted && availabilityUser['userId'].valid
    }" id="therapist" class="form-select" formControlName="userId">
  <option selected disabled value="">Select therapist</option>
  <option *ngFor="let list of therapistList" [value]="list.userId">
    {{ list.firstName }} {{ list.lastName }}
  </option>
</select>
  <div *ngIf="
                    availabilitySubmitted && availabilityUser['userId']['errors']
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="availabilityUser['userId']['errors']['required']">
                    Username is required
                  </div>
 </div>
</div>

          <!-- <div class="col-md-6">
            <label for="dayOfWeek" class="form-label">Day of Week</label>
         <select id="dayOfWeek" class="form-select" [ngClass]="{
      'is-invalid': availabilitySubmitted && availabilityUser['daysOfWeek'].invalid,
      'is-valid': availabilitySubmitted && availabilityUser['daysOfWeek'].valid
    }" formControlName="daysOfWeek">
  <option selected disabled value="">Select day</option>
  <option *ngFor="let list of dayOfWeek" [value]="list.id">
    {{ list.name }}
  </option>
</select>
 <div *ngIf="
                    availabilitySubmitted && availabilityUser['daysOfWeek']['errors']
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="availabilityUser['daysOfWeek']['errors']['required']">
                    DaysOfWeek is required
                  </div>
 </div>
          </div> -->
            <div class="col-md-4 col-12">
            <label for="startTime"  class="form-label">Start Time</label>
            <input type="time" class="form-control" formControlName="startTime" [ngClass]="{
      'is-invalid': availabilitySubmitted && availabilityUser['startTime'].invalid,
      'is-valid': availabilitySubmitted && availabilityUser['startTime'].valid
    }"/>
     <div *ngIf="
                    availabilitySubmitted && availabilityUser['startTime']['errors']
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="availabilityUser['startTime']['errors']['required']">
                    StartTime is required
                  </div>
 </div>
          </div>
    <div class="col-md-4 col-12">
            <label for="endTime" class="form-label">End Time</label>
            <input type="time" id="endTime" class="form-control" formControlName="endTime" [ngClass]="{
      'is-invalid': availabilitySubmitted && availabilityUser['endTime'].invalid,
      'is-valid': availabilitySubmitted && availabilityUser['endTime'].valid
    }"/>
     <div *ngIf="
                    availabilitySubmitted && availabilityUser['endTime']['errors']
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="availabilityUser['endTime']['errors']['required']">
                   EndTime is required
                  </div>
 </div>
          </div>

        </div>

        <div class="row mt-3">
         <div class="col-md-12 col-12">
  <label for="dayOfWeek" class="form-label block text-gray-700 font-medium mb-2">Day of Week</label>
  <div class="flex flex-wrap gap-2" id="dayOfWeek">
    <button
      type="button"
      *ngFor="let list of dayOfWeek"
(click)="toggleDay(list.id)"

      [ngClass]="{
        'bg-primary-border-color text-white': selectedDays.includes(list.id),
        'bg-white text-primary-border-color border border-blue-900': !selectedDays.includes(list.id)
      }"
      class="px-4 py-2 text-primary-border-color rounded-lg text-sm font-medium focus:outline-none"
    >
      {{ list.name }}
    </button>
  </div>

  <div *ngIf="
                    availabilitySubmitted && availabilityUser['daysOfWeek']['errors']
                  "
                  class="invalid-feedback">
    <div *ngIf="availabilityUser['daysOfWeek']['errors']['required']">
      Day of Week is required
    </div>
  </div>
</div>


      
        </div>

        <div class="row mt-3 align-items-center">
          <div class="col-md-9">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="availableToggle" checked formControlName="isAvailable" />
              <label class="form-check-label" for="availableToggle">Available for appointments</label>
            </div>
          </div>
          <div class="save-btn col-md-3 d-flex justify-content-end">
            <button type="submit" class="btn customBtn"> <i class="fa-solid fa-floppy-disk me-1"></i>{{ isEditMode ? 'Update Availability' : ' Save Availability' }}</button>

          </div>
        </div>

        <!-- <div class="row mt-3">
          <div class="col-md-6 d-flex align-items-center">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="repeatToggle" />
              <label class="form-check-label" for="repeatToggle">Repeat</label>
            </div>
          </div>
        </div> -->
      </form>
    </div>
  </div>

  <!-- Existing Availabilities Table -->
  <div *ngIf="selectedTab === 'existing-availability'" class="card-wrapper">
    <div class="card-body  mt-4">
      <h3 class="card-title">Existing Availabilities</h3>

<!-- <table mat-table [dataSource]="existingDataSource" matSort #existingSort="matSort" class="mat-elevation-z8 w-full">
  <ng-container matColumnDef="position">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>SI.No</th>
    <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
  </ng-container>

  <ng-container matColumnDef="Therapist">
    <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-doctor">Therapist</th>
    <td mat-cell *matCellDef="let row" class="col-doctor">{{ row.username}}</td>
  </ng-container>

  <ng-container matColumnDef="Day">
    <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-date">Day</th>
    <td mat-cell *matCellDef="let row" class="col-date">{{ row.dayName }}</td>
  </ng-container>

  <ng-container matColumnDef="StartTime">
    <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-time">StartTime</th>
    <td mat-cell *matCellDef="let row" class="col-time">{{ row.startTime }}</td>
  </ng-container>

  <ng-container matColumnDef="EndTime">
    <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-type">EndTime</th>
    <td mat-cell *matCellDef="let row" class="col-type">{{ row.endTime }}</td>
  </ng-container>

  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef class="col-action">Action</th>
    <td mat-cell *matCellDef="let row" class="col-action">
      <button mat-icon-button color="primary" matTooltip="Edit" (click)="editAvailability(row)">
<span><i style="color: #3863A7; font-size: 1.1rem;" class="fas fa-edit m-2"></i></span>  </button>
  <button mat-icon-button color="warn" matTooltip="Delete" (click)="deleteAvailability(row.id)">
<span><i style="color: #3863A7; font-size: 1.1rem;" class="fas fa-trash m-2"></i></span>  </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumnsTherapist"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumnsTherapist;"></tr>
</table>

<mat-paginator #existingPaginator [pageSizeOptions]="[5,10,25,50]"></mat-paginator> -->


<div class=" mt-1">
   <div class="mt-4 rounded-xl bg-white">
     <div class="flex gap-2 justify-between mb-3">
      <div class="relative flex items-center">
      <input
        type="text"
        id="searchInput"
        class="w-full px-4 m-2 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary-border-color focus:border-transparent"
        [(ngModel)]="searchValue"
        (input)="onQuickFilterChanged()"
        placeholder="Search patients...">
      <button
        class="px-4 py-2 bg-gray-100 text-gray-600 border border-l-0 border-gray-300 rounded-r-lg hover:bg-primary-border-color hover:text-white transition-colors"
        *ngIf="searchValue"
        (click)="searchValue=''; onQuickFilterChanged()">
        Clear
      </button>
    </div>
    
 <button 
  class="flex items-center gap-2 px-2.5 py-1 border border-green-600 text-green-600 rounded-md text-sm hover:bg-green-600 hover:text-white transition"
  (click)="onExportClick()"
>
  <i class="fas fa-file-excel text-sm"></i>
  <span>Export Excel</span>
</button>

</div>

  

<ag-grid-angular
  class="ag-theme-alpine ag-theme-custom"
  [gridOptions]="gridOptions"
  [rowData]="rowData"
  [columnDefs]="columnDefs"
  [defaultColDef]="defaultColDef"
  [pagination]="true"
  [paginationPageSize]="paginationPageSize"
  style="width: 100%; height: 500px;">
</ag-grid-angular>


</div>

  </div>

    </div>
  </div>

  <div *ngIf="selectedTab === 'list-leave'" class="card-wrapper">
  <div class="card-body mt-4">
    <h3 class="card-title">List of Doctor Leaves</h3>
<div class=" mt-1">
   <div class="mt-4 rounded-xl bg-white">
     <div class="flex gap-2 justify-between mb-3">
      <div class="relative flex items-center">
      <input
        type="text"
        id="searchInput"
        class="w-full px-4 m-2 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary-border-color focus:border-transparent"
        [(ngModel)]="searchValue"
        (input)="onQuickFilterChanged()"
        placeholder="Search patients...">
      <button
        class="px-4 py-2 bg-gray-100 text-gray-600 border border-l-0 border-gray-300 rounded-r-lg hover:bg-primary-border-color hover:text-white transition-colors"
        *ngIf="searchValue"
        (click)="searchValue=''; onQuickFilterChanged()">
        Clear
      </button>
    </div>
    
 <button 
  class="flex items-center gap-2 px-2.5 py-1 border border-green-600 text-green-600 rounded-md text-sm hover:bg-green-600 hover:text-white transition"
  (click)="onExportClick()"
>
  <i class="fas fa-file-excel text-sm"></i>
  <span>Export Excel</span>
</button>

</div>

  

<ag-grid-angular
  class="ag-theme-alpine ag-theme-custom"
  [gridOptions]="gridOptionsLeave"
  [rowData]="rowDataLeave"
  [columnDefs]="columnDefsLeave"
  [defaultColDef]="defaultColDef"
  [pagination]="true"
  [paginationPageSize]="paginationPageSize"
  style="width: 100%; height: 500px;">
</ag-grid-angular>


</div>

  </div>


  </div>
</div>


  <!-- Leave Popup Form -->
  <div class="popup-form" *ngIf="selectedTab === 'leave' && isPopupOpen">
    <div class="popup-content  mt-4">
      <span class="close-btn" (click)="closePopup()"></span>
     <div class="card-body">
<h3>{{ isEditMode ? 'Update Leave' : 'Leave Form' }}</h3>
      <form [formGroup]="Leaveform" (ngSubmit)="onSubmitLeave()">
  <div class="row mt-2">
    <div class="col-md-4 col-12">
      <div >
           <label for="therapist" class="form-label">Therapist Name</label>
           <select [ngClass]="{
      'is-invalid': leaveUserSubmitted && leaveFormUser['therapistName'].invalid,
      'is-valid': leaveUserSubmitted && leaveFormUser['therapistName'].valid
    }" id="therapist" class="form-select" formControlName="therapistName">
  <option selected disabled value="">Select therapist</option>
  <option *ngFor="let list of therapistList" [value]="list.userId">
    {{ list.firstName }} {{ list.lastName }}
  </option>
</select>
  <div *ngIf="
                    leaveUserSubmitted && leaveFormUser['therapistName']['errors']
                  "
                  class="invalid-feedback"
                >
                  <div *ngIf="leaveFormUser['therapistName']['errors']['required']">
                    therapist Name is required
                  </div>
 </div>
      </div>
    </div>
    <div class="col-md-4 col-12">
      <div>
        <label class="form-label">Leave Date</label>
        <input type="date" class="form-control" formControlName="leaveDate" />
      </div>
    </div>
     <div class="col-md-4 col-12">
      <div>
        <label class="form-label">Reason for leave</label>
        <input class="form-control" placeholder="Enter reason"
                  formControlName="reason">
      </div>
    </div>
  </div>

  <div class="row mt-3" *ngIf="isshowTime">
    <div class="col-md-6 col-12">
      <div >
        <label for="startTime" class="form-label">Start Time</label>
        <input type="time" id="startTime" class="form-control" formControlName="startTime" />
      </div>
    </div>
    <div class="col-6">
      <div>
        <label for="endTime" class="form-label">End Time</label>
        <input type="time" id="endTime" class="form-control" formControlName="endTime" />
      </div>
    </div>
  </div>
  <div class="row mt-3">
   
  </div>

  <div class="row mt-3">
    <div class="col-6">
      <input  type="checkbox" id="isfullday"
             formControlName="isfullday"
             (change)="onFullDayToggle()" />
      <label class="form-check-label" for="isfullday">Full day</label>
    </div>
     <div class="col-6">
      <div class="save-btn" style="display: flex; justify-content: right;">
<button type="submit" class="customBtn">  <i class="fa-solid fa-floppy-disk me-1"></i>
  {{ isEditMode ? 'Update Leave' : 'Save Leave' }}
</button>
      </div>
    </div>
  </div>


</form>

     </div>
    </div>
  </div>
</div>



 <!-- <div class="mb-3">
          <label class="form-label">Therapist Name</label>
          <input type="text" class="form-control" placeholder="Enter therapist name" />
        </div>
        <div class="mb-3">
          <label class="form-label">Leave Date</label>
          <input type="date" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Reason</label>
          <textarea class="form-control" rows="3"></textarea>
        </div>
        <div class="save-btn">
          <button type="submit" class="btn">Submit Leave</button>
        </div> -->

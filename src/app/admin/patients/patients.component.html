<!-- Enhanced Patient Assessment Form with Modern Design -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-4">
  <div class="max-w-7xl mx-auto">
    
    <!-- Header Section -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6 mb-6">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        
        <!-- Patient Info -->
        <div class="flex items-center space-x-4">
          <div class="w-16 h-16 bg-gradient-to-br from-primary-orange to-orange-600 rounded-full flex items-center justify-center text-white text-xl font-bold shadow-lg">
            {{ getPatientInitials() }}
          </div>
          <div>
            <h1 class="text-2xl font-bold text-gray-900">Patient Assessment</h1>
            <p class="text-gray-600">Complete medical evaluation form</p>
          </div>
        </div>

        <!-- Action Buttons & Status -->
        <div class="flex items-center space-x-4">
          <!-- Auto-save Status -->
          <div class="flex items-center space-x-2 px-4 py-2 rounded-full border" 
               [ngClass]="{
                 'bg-green-50 border-green-200 text-green-700': saveStatus === 'saved',
                 'bg-yellow-50 border-yellow-200 text-yellow-700': saveStatus === 'saving',
                 'bg-red-50 border-red-200 text-red-700': saveStatus === 'unsaved'
               }">
            <div class="w-2 h-2 rounded-full" 
                 [ngClass]="{
                   'bg-green-500': saveStatus === 'saved',
                   'bg-yellow-500 animate-pulse': saveStatus === 'saving',
                   'bg-red-500': saveStatus === 'unsaved'
                 }"></div>
            <span class="text-sm font-medium">
              {{ saveStatus === 'saved' ? 'All changes saved' : 
                 saveStatus === 'saving' ? 'Saving...' : 
                 'Unsaved changes' }}
            </span>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-3">
            <button type="button" 
                    (click)="resetForm()"
                    class="px-4 py-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-all duration-200 flex items-center space-x-2">
              <i class="fas fa-undo text-sm"></i>
              <span>Reset</span>
            </button>
            
            <button type="button" 
                    (click)="saveAssessment()"
                    [disabled]="isSaving"
                    class="px-6 py-2 bg-gradient-to-r from-primary-orange to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center space-x-2 shadow-lg">
              <i class="fas" [ngClass]="isSaving ? 'fa-spinner fa-spin' : 'fa-save'"></i>
              <span>{{ getSaveButtonText() }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Form Container -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
      
      <!-- Progress Indicator -->
      <div class="bg-gradient-to-r from-primary-orange to-orange-600 h-1">
        <div class="h-full bg-white bg-opacity-30 transition-all duration-500" 
             [style.width.%]="getFormCompletionPercentage()"></div>
      </div>

      <!-- Form Content -->
      <div class="p-8">
        <form [formGroup]="assessmentForm" class="space-y-8">

          <!-- Chief Complaints Section -->
          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
            <div class="flex items-center space-x-3 mb-6">
              <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-notes-medical text-white"></i>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-900">Chief Complaints</h2>
                <p class="text-gray-600 text-sm">Primary symptoms and concerns</p>
              </div>
            </div>

            <div formArrayName="chiefComplaints" class="space-y-4">
              <div *ngFor="let complaint of chiefComplaintsArray.controls; let i = index" 
                   [formGroupName]="i"
                   class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200">
                
                <div class="flex items-start justify-between mb-4">
                  <h3 class="text-lg font-semibold text-gray-800">Complaint {{ i + 1 }}</h3>
                  <button type="button" 
                          (click)="removeChiefComplaint(i)"
                          *ngIf="chiefComplaintsArray.length > 1"
                          class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-all duration-200">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                  <div class="lg:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-comment-medical mr-2 text-blue-500"></i>
                      Complaint Description
                    </label>
                    <textarea formControlName="complaint"
                              (input)="onFormChange()"
                              placeholder="Describe the main complaint or symptom..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200"
                              rows="3"></textarea>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-thermometer-half mr-2 text-red-500"></i>
                      Pain Scale (0-10)
                    </label>
                    <div class="relative">
                      <input type="number" 
                             formControlName="painScale"
                             (input)="onFormChange()"
                             min="0" max="10"
                             placeholder="0-10"
                             class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                      <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                        <div class="w-3 h-3 rounded-full" 
                             [ngClass]="{
                               'bg-green-400': complaint.get('painScale')?.value <= 3,
                               'bg-yellow-400': complaint.get('painScale')?.value > 3 && complaint.get('painScale')?.value <= 6,
                               'bg-red-400': complaint.get('painScale')?.value > 6,
                               'bg-gray-300': !complaint.get('painScale')?.value
                             }"></div>
                      </div>
                    </div>
                  </div>

                  <div class="lg:col-span-3">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-sticky-note mr-2 text-yellow-500"></i>
                      Additional Notes
                    </label>
                    <textarea formControlName="notes"
                              (input)="onFormChange()"
                              placeholder="Any additional details or observations..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200"
                              rows="2"></textarea>
                  </div>
                </div>
              </div>
            </div>

            <button type="button" 
                    (click)="addChiefComplaint()"
                    class="mt-4 w-full py-3 border-2 border-dashed border-blue-300 text-blue-600 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 flex items-center justify-center space-x-2">
              <i class="fas fa-plus"></i>
              <span>Add Another Complaint</span>
            </button>
          </div>

          <!-- Vital Signs Section -->
          <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
            <div class="flex items-center space-x-3 mb-6">
              <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-heartbeat text-white"></i>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-900">Vital Signs</h2>
                <p class="text-gray-600 text-sm">Essential health measurements</p>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <!-- Blood Pressure -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-tint mr-2 text-red-500"></i>
                  Blood Pressure
                </label>
                <div class="flex space-x-2">
                  <div class="flex-1">
                    <input type="number" 
                           formControlName="systolic"
                           (input)="onFormChange(); validateBloodPressure()"
                           placeholder="120"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                    <span class="text-xs text-gray-500 mt-1 block">Systolic</span>
                  </div>
                  <div class="flex items-center text-gray-400 font-bold">/</div>
                  <div class="flex-1">
                    <input type="number" 
                           formControlName="diastolic"
                           (input)="onFormChange(); validateBloodPressure()"
                           placeholder="80"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                    <span class="text-xs text-gray-500 mt-1 block">Diastolic</span>
                  </div>
                </div>
                <span class="text-xs text-gray-500 mt-2 block">mmHg</span>
              </div>

              <!-- Heart Rate -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-heartbeat mr-2 text-red-500"></i>
                  Heart Rate
                </label>
                <input type="number" 
                       formControlName="heartRate"
                       (input)="onFormChange()"
                       placeholder="72"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">bpm</span>
              </div>

              <!-- Temperature -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-thermometer-half mr-2 text-orange-500"></i>
                  Temperature
                </label>
                <input type="number" 
                       formControlName="temperature"
                       (input)="onFormChange()"
                       step="0.1"
                       placeholder="98.6"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">°F</span>
              </div>

              <!-- Respiratory Rate -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-lungs mr-2 text-blue-500"></i>
                  Respiratory Rate
                </label>
                <input type="number" 
                       formControlName="respiratoryRate"
                       (input)="onFormChange()"
                       placeholder="16"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">breaths/min</span>
              </div>

              <!-- Additional Vitals Row -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-eye mr-2 text-purple-500"></i>
                  Pulse
                </label>
                <input type="number" 
                       formControlName="pulse"
                       (input)="onFormChange()"
                       placeholder="72"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">bpm</span>
              </div>

              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-tint mr-2 text-red-600"></i>
                  Blood Sugar
                </label>
                <input type="number" 
                       formControlName="bloodSugar"
                       (input)="onFormChange()"
                       placeholder="100"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">mg/dL</span>
              </div>

              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-percentage mr-2 text-blue-600"></i>
                  SpO₂
                </label>
                <input type="number" 
                       formControlName="spO2"
                       (input)="onFormChange()"
                       placeholder="98"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">%</span>
              </div>

              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-weight mr-2 text-indigo-500"></i>
                  Weight
                </label>
                <input type="number" 
                       formControlName="weight"
                       (input)="onFormChange(); calculateBMI()"
                       step="0.1"
                       placeholder="70"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">kg</span>
              </div>
            </div>

            <!-- Height and BMI Row -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-ruler-vertical mr-2 text-purple-500"></i>
                  Height
                </label>
                <input type="number" 
                       formControlName="height"
                       (input)="onFormChange(); calculateBMI()"
                       step="0.1"
                       placeholder="170"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">cm</span>
              </div>

              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-calculator mr-2 text-green-500"></i>
                  BMI (Auto-calculated)
                </label>
                <input type="number" 
                       formControlName="bmi"
                       readonly
                       placeholder="Calculated automatically"
                       class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg transition-all duration-200">
                <span class="text-xs text-gray-500 mt-2 block">kg/m²</span>
              </div>

              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm flex items-center justify-center">
                <div class="text-center">
                  <div class="w-16 h-16 mx-auto mb-2 rounded-full border-4 flex items-center justify-center"
                       [ngClass]="{
                         'border-blue-400 text-blue-600': getBMICategory() === 'Underweight',
                         'border-green-400 text-green-600': getBMICategory() === 'Normal',
                         'border-yellow-400 text-yellow-600': getBMICategory() === 'Overweight',
                         'border-red-400 text-red-600': getBMICategory() === 'Obese',
                         'border-gray-400 text-gray-600': !getBMICategory()
                       }">
                    <i class="fas fa-user text-2xl"></i>
                  </div>
                  <p class="text-sm font-medium text-gray-700">{{ getBMICategory() || 'Enter height & weight' }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Medical History Section -->
          <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">
            <div class="flex items-center space-x-3 mb-6">
              <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-history text-white"></i>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-900">Medical History</h2>
                <p class="text-gray-600 text-sm">Allergies, medications, and conditions</p>
              </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Allergies -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-exclamation-triangle mr-2 text-red-500"></i>
                  Allergies
                </label>
                <div class="space-y-2 max-h-40 overflow-y-auto">
                  <div *ngFor="let allergy of allergyOptions" class="flex items-center">
                    <input type="checkbox" 
                           [id]="'allergy-' + allergy.id"
                           [checked]="isAllergySelected(allergy.value)"
                           (change)="toggleAllergy(allergy.value)"
                           class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                    <label [for]="'allergy-' + allergy.id" 
                           class="ml-2 text-sm text-gray-700 cursor-pointer hover:text-purple-600 transition-colors duration-200">
                      {{ allergy.value }}
                    </label>
                  </div>
                </div>
              </div>

              <!-- Medications -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-pills mr-2 text-green-500"></i>
                  Current Medications
                </label>
                <div class="space-y-2 max-h-40 overflow-y-auto">
                  <div *ngFor="let medication of medicationOptions" class="flex items-center">
                    <input type="checkbox" 
                           [id]="'medication-' + medication.id"
                           [checked]="isMedicationSelected(medication.name)"
                           (change)="toggleMedication(medication.name)"
                           class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                    <label [for]="'medication-' + medication.id" 
                           class="ml-2 text-sm text-gray-700 cursor-pointer hover:text-purple-600 transition-colors duration-200">
                      {{ medication.name }}
                    </label>
                  </div>
                </div>
              </div>

              <!-- Chronic Conditions -->
              <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  <i class="fas fa-procedures mr-2 text-orange-500"></i>
                  Chronic Conditions
                </label>
                <div class="space-y-2 max-h-40 overflow-y-auto">
                  <div *ngFor="let condition of chronicConditionOptions" class="flex items-center">
                    <input type="checkbox" 
                           [id]="'condition-' + condition.id"
                           [checked]="isChronicConditionSelected(condition.value)"
                           (change)="toggleChronicCondition(condition.value)"
                           class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                    <label [for]="'condition-' + condition.id" 
                           class="ml-2 text-sm text-gray-700 cursor-pointer hover:text-purple-600 transition-colors duration-200">
                      {{ condition.value }}
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Surgical History Section -->
          <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-xl p-6 border border-red-200">
            <div class="flex items-center space-x-3 mb-6">
              <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-cut text-white"></i>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-900">Surgical History</h2>
                <p class="text-gray-600 text-sm">Previous surgeries and procedures</p>
              </div>
            </div>

            <div formArrayName="surgicalHistory" class="space-y-4">
              <div *ngFor="let surgery of surgicalHistoryArray.controls; let i = index" 
                   [formGroupName]="i"
                   class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200">
                
                <div class="flex items-start justify-between mb-4">
                  <h3 class="text-lg font-semibold text-gray-800">Surgery {{ i + 1 }}</h3>
                  <button type="button" 
                          (click)="removeSurgicalHistory(i)"
                          *ngIf="surgicalHistoryArray.length > 1"
                          class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-all duration-200">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-scalpel mr-2 text-red-500"></i>
                      Procedure
                    </label>
                    <input type="text" 
                           formControlName="procedure"
                           (input)="onFormChange()"
                           placeholder="e.g., Appendectomy"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200">
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-calendar mr-2 text-blue-500"></i>
                      Surgery Date
                    </label>
                    <input type="date" 
                           formControlName="surgeryDate"
                           (input)="onFormChange()"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200">
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-hospital mr-2 text-green-500"></i>
                      Hospital/Clinic
                    </label>
                    <input type="text" 
                           formControlName="hospital"
                           (input)="onFormChange()"
                           placeholder="e.g., City General Hospital"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200">
                  </div>
                </div>
              </div>
            </div>

            <button type="button" 
                    (click)="addSurgicalHistory()"
                    class="mt-4 w-full py-3 border-2 border-dashed border-red-300 text-red-600 rounded-lg hover:border-red-400 hover:bg-red-50 transition-all duration-200 flex items-center justify-center space-x-2">
              <i class="fas fa-plus"></i>
              <span>Add Surgery Record</span>
            </button>
          </div>

          <!-- Family History Section -->
          <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-6 border border-yellow-200">
            <div class="flex items-center space-x-3 mb-6">
              <div class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-users text-white"></i>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-900">Family History</h2>
                <p class="text-gray-600 text-sm">Hereditary conditions and family medical history</p>
              </div>
            </div>

            <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div *ngFor="let condition of familyHistoryOptions" class="flex items-center p-3 rounded-lg hover:bg-yellow-50 transition-colors duration-200">
                  <input type="checkbox" 
                         [id]="'family-' + condition.id"
                         [checked]="isFamilyHistorySelected(condition.value)"
                         (change)="toggleFamilyHistory(condition.value)"
                         class="w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500">
                  <label [for]="'family-' + condition.id" 
                         class="ml-3 text-sm text-gray-700 cursor-pointer">
                    {{ condition.value }}
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Social Habits Section -->
          <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-6 border border-indigo-200">
            <div class="flex items-center space-x-3 mb-6">
              <div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center">
                <i class="fas fa-smoking text-white"></i>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-900">Social & Lifestyle Habits</h2>
                <p class="text-gray-600 text-sm">Smoking, alcohol, and other lifestyle factors</p>
              </div>
            </div>

            <div formArrayName="socialHabits" class="space-y-6">
              <div *ngFor="let habit of socialHabitsArray.controls; let i = index; trackBy: trackByIndex" 
                   [formGroupName]="i"
                   class="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <!-- Smoking Status -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-smoking mr-2 text-gray-600"></i>
                      Smoking Status
                    </label>
                    <select formControlName="smokingStatusId"
                            (change)="onFormChange()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                      <option value="">Select status</option>
                      <option *ngFor="let option of smokingOptions" [value]="option.id">
                        {{ option.value }}
                      </option>
                    </select>
                  </div>

                  <!-- Cigarettes per day -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-calculator mr-2 text-orange-500"></i>
                      Cigarettes/Day
                    </label>
                    <input type="number" 
                           formControlName="cigarettesPerDay"
                           (input)="onFormChange()"
                           min="0"
                           placeholder="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                  </div>

                  <!-- Alcohol Status -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-wine-glass mr-2 text-purple-600"></i>
                      Alcohol Status
                    </label>
                    <select formControlName="alcoholStatusId"
                            (change)="onFormChange()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                      <option value="">Select status</option>
                      <option *ngFor="let option of alcoholOptions" [value]="option.id">
                        {{ option.value }}
                      </option>
                    </select>
                  </div>

                  <!-- Alcohol Frequency -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-clock mr-2 text-blue-500"></i>
                      Frequency
                    </label>
                    <input type="text" 
                           formControlName="alcoholFrequency"
                           (input)="onFormChange()"
                           placeholder="e.g., Weekly, Daily"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                  </div>

                  <!-- Beverage Status -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-coffee mr-2 text-brown-500"></i>
                      Beverage Status
                    </label>
                    <select formControlName="beverageStatusId"
                            (change)="onFormChange()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                      <option value="">Select status</option>
                      <option *ngFor="let option of beverageOptions" [value]="option.id">
                        {{ option.value }}
                      </option>
                    </select>
                  </div>

                  <!-- Cups per day -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-mug-hot mr-2 text-brown-600"></i>
                      Cups/Day
                    </label>
                    <input type="number" 
                           formControlName="cupsPerDay"
                           (input)="onFormChange()"
                           min="0"
                           placeholder="0"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                  </div>

                  <!-- Drug Usage Status -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-prescription-bottle mr-2 text-red-600"></i>
                      Drug Usage
                    </label>
                    <select formControlName="drugUsageStatusId"
                            (change)="onFormChange()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                      <option value="">Select status</option>
                      <option *ngFor="let option of drugUsageOptions" [value]="option.id">
                        {{ option.value }}
                      </option>
                    </select>
                  </div>

                  <!-- Drug Details -->
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                      Drug Details
                    </label>
                    <input type="text" 
                           formControlName="drugDetails"
                           (input)="onFormChange()"
                           placeholder="Specify if applicable"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200">
                  </div>
                </div>
              </div>
            </div>

            <button type="button" 
                    (click)="addSocialHabit()"
                    class="mt-4 w-full py-3 border-2 border-dashed border-indigo-300 text-indigo-600 rounded-lg hover:border-indigo-400 hover:bg-indigo-50 transition-all duration-200 flex items-center justify-center space-x-2">
              <i class="fas fa-plus"></i>
              <span>Add Social Habit Record</span>
            </button>
          </div>

        </form>
      </div>
    </div>

    <!-- Floating Action Button for Mobile -->
    <div class="fixed bottom-6 right-6 lg:hidden">
      <button type="button" 
              (click)="saveAssessment()"
              [disabled]="isSaving"
              class="w-14 h-14 bg-gradient-to-r from-primary-orange to-orange-600 text-white rounded-full shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center">
        <i class="fas" [ngClass]="isSaving ? 'fa-spinner fa-spin' : 'fa-save'" class="text-xl"></i>
      </button>
    </div>

  </div>
</div>

<!-- Loading Overlay -->
<div *ngIf="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl p-8 shadow-2xl">
    <div class="flex items-center space-x-4">
      <div class="w-8 h-8 border-4 border-primary-orange border-t-transparent rounded-full animate-spin"></div>
      <span class="text-lg font-medium text-gray-700">Loading assessment data...</span>
    </div>
  </div>
</div>
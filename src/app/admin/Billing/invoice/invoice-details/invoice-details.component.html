<div class="dashboard-container container">

<div class="p-2">
  <h4 class="text-xl font-semibold mb-2">Invoices</h4>

  <!-- Search Box -->
    <div class="w-full flex justify-end">
      <div class="mb-2">
        <div class="relative flex items-center">
          <input
            type="text"
            id="searchInput"
            class="w-full px-4 m-2 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-[#3863A7] focus:border-transparent"
            [(ngModel)]="searchValue"
            (input)="onQuickFilterChanged()"
            placeholder="Search patients..." />
          <button
            class="px-4 py-2 bg-gray-100 text-gray-600 border border-l-0 border-gray-300 rounded-r-lg hover:bg-[#3863A7] hover:text-white transition-colors"
            *ngIf="searchValue"
            (click)="searchValue=''; onQuickFilterChanged()">
            Clear
          </button>
        </div>
      </div>
    </div>

    <!-- AG Grid -->
    <ag-grid-angular
      class="ag-theme-alpine ag-theme-custom border rounded"
      style="width: 100%;"
      [gridOptions]="gridOptions"
      [rowData]="invoiceData"
      [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef"
      [pagination]="true"
      [paginationPageSize]="7"
      [paginationPageSizeSelector]="[7, 20, 50, 100]"
      [domLayout]="'autoHeight'"
      (gridReady)="onGridReady($event)">
    </ag-grid-angular>
</div>
</div>
<!-- Popup -->


<div *ngIf="showInvoicePopup && selectedInvoice" role="dialog" aria-modal="true" class="fixed inset-0 z-50 flex items-center justify-center">
<!-- Overlay -->
<div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
 
  <!-- Modal content -->
<div class="bg-white rounded-lg shadow-lg z-50 max-w-4xl w-full mx-4 p-6 relative" id="invoice-pdf">
<!-- Header -->
<div class="flex justify-between items-start mb-6">
<div>
<img [src]="image" alt="Logo" class="h-16 mb-2" />
</div>
<div class="text-right">
<h2 class="text-xl font-bold text-gray-800">INVOICE</h2>
<p class="text-sm text-gray-600"><strong>Invoice # :</strong> {{ selectedInvoice.invoiceNumber }}</p>
<p class="text-sm text-gray-600"><strong>Date :</strong> {{ selectedInvoice.appointmentDate | date: 'dd-MM-yyyy' }}</p>
<p class="text-sm text-gray-600"><strong>Status :</strong> {{ selectedInvoice.status }}</p>
</div>
</div>
 
    <!-- Patient & Appointment Info -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 text-sm mb-6 border border-gray-200 rounded p-4 bg-gray-50">
<div>
<h3 class="font-semibold text-gray-700 mb-1">Patient Info</h3>
<p><strong>Name :</strong>    {{ selectedInvoice.patientName }}</p>
<p><strong>Therapist :</strong> {{ selectedInvoice.therapist }}</p>
<p><strong>Appointment :</strong> {{ selectedInvoice.appointmentDate | date: 'dd-MM-yyyy hh:mm a' }}</p>
</div>
<div>
<h3 class="font-semibold text-gray-700 mb-1">Billing Info</h3>
<p><strong>Total : </strong> {{ selectedInvoice.totalAmount  | currency: 'USD':'symbol':'1.2-2' }}</p>
<p><strong>Amount Paid :</strong> {{ selectedInvoice.amountPaid  | currency: 'USD':'symbol':'1.2-2'}}</p>
<p><strong>Balance :</strong> {{ selectedInvoice.balance  | currency: 'USD':'symbol':'1.2-2'}}</p>
</div>
</div>
 
    <!-- Insurance & Copay -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 text-sm mb-6 border border-gray-200 rounded p-4">
<div>
<p><strong>Copay :</strong> {{ selectedInvoice.copayAmount  | currency: 'USD':'symbol':'1.2-2' }}</p>
<p><strong>Insurance Billed :</strong> {{ selectedInvoice.insuranceBilledAmount  | currency: 'USD':'symbol':'1.2-2' }}</p>
<p>
<strong>Sliding Scale : </strong>
<ng-container *ngIf="selectedInvoice.slidingScaleApplied; else noScale">

             Yes ({{ selectedInvoice.slidingScaleDiscountPercentage || 0  | currency: 'USD':'symbol':'1.2-2' }}% â€” {{ selectedInvoice.slidingScaleAmount || 0  | currency: 'USD':'symbol':'1.2-2' }})
</ng-container>
<ng-template #noScale>No</ng-template>
</p>
</div>
<div *ngIf="selectedInvoice.notes">
<p><strong>Notes :</strong> {{ selectedInvoice.notes }}</p>
</div>
</div>
 
    <!-- Payment History -->
<div *ngIf="selectedInvoice.payments?.length > 0" class="mb-6">
<h4 class="text-md font-semibold mb-3 border-b pb-1">Payment History</h4>
<table class="w-full table-auto border border-collapse border-gray-300 text-sm">
<thead class="bg-gray-100 text-left">
<tr>
<th class="border px-3 py-2">Date</th>
<th class="border px-3 py-2">Method</th>
<th class="border px-3 py-2">Amount</th>
<th class="border px-3 py-2">Status</th>
<th class="border px-3 py-2">Notes</th>
</tr>
</thead>
<tbody>
<tr *ngFor="let payment of selectedInvoice.payments">
<td class="border px-3 py-2"> {{ payment.date | date : 'dd-MM-yyyy' }}</td>
<td class="border px-3 py-2"> {{ payment.method }}</td>
<td class="border px-3 py-2"> {{ payment.amount  | currency: 'USD':'symbol':'1.2-2' }}</td>
<td class="border px-3 py-2"> {{ payment.status }}</td>
<td class="border px-3 py-2"> {{ payment.notes || '-' }}</td>
</tr>
</tbody>
</table>
</div>
 
    <!-- No payments fallback -->
<div *ngIf="selectedInvoice.payments?.length === 0" class="text-sm text-gray-500 italic mb-6">

      No payments recorded for this invoice.
</div>
 
    <!-- Footer Actions -->
<div class="flex justify-end gap-2 no-print">
<button (click)="downloadPDF()" class="text-sm bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded flex items-center">
<i class="fas fa-file-pdf mr-2"></i> Download PDF
</button>
<button type="button" class="text-sm bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded" (click)="closeInvoiceModal()">

        Close
</button>
</div>
</div>
</div>

 


 

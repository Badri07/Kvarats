<div class=" mt-1 mx-6">
   <div class="mt-4 rounded-xl bg-white p-6">
     <div class="flex gap-2 justify-between mb-3">
      <div class="relative flex items-center">
      <input
        type="text"
        id="searchInput"
        class="w-full px-4 m-2 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary-border-color focus:border-transparent"
        [(ngModel)]="searchValue"
        (input)="onQuickFilterChanged()"
        placeholder="Search patients...">
      <button
        class="px-4 py-2 bg-gray-100 text-gray-600 border border-l-0 border-gray-300 rounded-r-lg hover:bg-primary-border-color hover:text-white transition-colors"
        *ngIf="searchValue"
        (click)="searchValue=''; onQuickFilterChanged()">
        Clear
      </button>
    </div>
    
 <button 
  class="flex items-center gap-2 px-2.5 py-1 border border-green-600 text-green-600 rounded-md text-sm hover:bg-green-600 hover:text-white transition"
  (click)="onExportClick()"
>
  <i class="fas fa-file-excel text-sm"></i>
  <span>Export Excel</span>
</button>

</div>

  

<ag-grid-angular
  class="ag-theme-alpine ag-theme-custom"
  [gridOptions]="gridOptions"
  [rowData]="rowData"
  [columnDefs]="columnDefs"
  [defaultColDef]="defaultColDef"
  [pagination]="true"
  [paginationPageSize]="paginationPageSize"
  [paginationPageSizeSelector]="paginationPageSizeSelector"
  style="width: 100%; height: 500px;">
</ag-grid-angular>


</div>

  </div>


<div *ngIf="isshowPayment" class="fixed inset-0 flex items-center justify-center bg-black/40 z-50">
  <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-4">
    <!-- Header with close button -->
    <div class="flex justify-between items-center p-4 border-b">
      <h3 class="text-lg font-semibold">Make Payment</h3>
      <button (click)="isshowPayment = false" class="text-gray-500 hover:text-gray-700">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Compact Content -->
    <div class="p-4 space-y-4">
      <!-- Invoice Summary -->
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div class="text-gray-500">Invoice #</div>
        <div class="font-medium">{{invoicePayload.invoiceNumber}}</div>
        <div class="text-gray-500">Balance Due ($)</div>
        <div class="font-bold">{{invoicePayload.balanceDue | number:'1.2-2'}}</div>
      </div>

      <!-- Payment Amount -->
      <div>
        <label class="block text-sm text-gray-700 mb-1">Amount ($)</label>
        <input type="number" [(ngModel)]="paymentAmount" 
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-400"
              [max]="invoicePayload.balanceDue"  
              min="1">
      </div>

      <!-- Payment Method -->
      <div>
        <label class="block text-sm text-gray-700 mb-1">Method</label>
        <select [(ngModel)]="paymentMethod" class="w-full px-3 py-2 border rounded-lg text-sm">
          <option value="CREDIT_CARD">Credit Card</option>
          <option value="DEBIT_CARD">Debit Card</option>
          <option value="BANK_TRANSFER">Bank Transfer (ACH)</option>
          <option value="CASH">Cash</option>
        </select>
      </div>

      <!-- Card Fields (Conditional) -->
      <div *ngIf="paymentMethod === 'CREDIT_CARD' || paymentMethod === 'DEBIT_CARD'" 
           class="grid grid-cols-2 gap-3 text-sm">
        <div class="col-span-2">
          <input type="text" placeholder="Card Number" class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div>
          <input type="text" placeholder="MM/YY" class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div>
          <input type="text" placeholder="CVV" class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div class="col-span-2">
          <input type="text" placeholder="Cardholder Name" class="w-full px-3 py-2 border rounded-lg">
        </div>
      </div>

      <!-- Bank Transfer Fields (Conditional) -->
      <div *ngIf="paymentMethod === 'BANK_TRANSFER'" class="space-y-3 text-sm">
        <div>
          <label class="block text-gray-700 mb-1">Routing Number (ABA)</label>
          <input type="text" placeholder="9-digit routing number" 
                 class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div>
          <label class="block text-gray-700 mb-1">Account Number</label>
          <input type="text" placeholder="Account number" 
                 class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div>
          <label class="block text-gray-700 mb-1">Account Type</label>
          <select class="w-full px-3 py-2 border rounded-lg">
            <option value="CHECKING">Checking</option>
            <option value="SAVINGS">Savings</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-700 mb-1">Account Holder Name</label>
          <input type="text" placeholder="Name as on bank account" 
                 class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div class="text-xs text-gray-500">
          <p>By providing your bank details, you authorize this payment via ACH transfer.</p>
        </div>
      </div>

      <!-- Submit Button -->
      <button (click)="onNextPayment()" 
              class="w-full bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg mt-2 text-sm font-medium"
              [disabled]="!paymentAmount || paymentAmount <= 0 || paymentAmount > invoicePayload.remainingBalance">
        <span *ngIf="!showPaymentProcessing">Confirm Payment</span>
        <span *ngIf="showPaymentProcessing">Processing...</span>
      </button>

      <!-- Error Message -->
      <div *ngIf="paymentError" class="text-red-500 text-xs text-center mt-2">
        {{paymentError}}
      </div>

      <!-- Stripe Payment Error -->
      <div *ngIf="checkoutLoading" class="text-center mt-4">
        <div class="flex items-center justify-center">
          <svg class="animate-spin h-5 w-5 text-orange-500 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span class="text-sm text-gray-600">Redirecting to Stripe...</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Payment Confirmation Dialog -->
<div *ngIf="isshowpaymentConfirmation" class="fixed inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm z-50">
  <div class="bg-white rounded-2xl shadow-lg w-full max-w-md p-6 relative">
    <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" (click)="closePaymentConfirmation()">
      ✕
    </button>

    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
        <i class="fas fa-check text-green-600 text-2xl"></i>
      </div>
      
      <h2 class="text-xl font-bold text-gray-800">Payment Successful!</h2>
      <p class="text-gray-600 mt-2">₹{{paymentAmount | number:'1.2-2'}} paid successfully</p>
      
      <div class="mt-4 bg-gray-50 p-4 rounded-lg">
        <div class="flex justify-between mb-2">
          <span class="text-gray-600">Transaction ID:</span>
          <span class="font-medium">{{transactionId}}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Invoice:</span>
          <span class="font-medium">{{invoicePayload.invoiceNumber}}</span>
        </div>
      </div>

      <button (click)="closePaymentConfirmation()"
              class="w-full bg-orange-400 hover:bg-orange-500 text-white py-2 rounded-lg mt-6">
        Done
      </button>
    </div>
  </div>
</div>